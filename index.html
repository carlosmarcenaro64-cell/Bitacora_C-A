<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bit√°cora de C/A | Carlos Manuel Paname√±o Marcenaro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="logo-container">
        <h1 class="ca-title">Bit√°cora de C/A</h1>
        <div class="glow-effect"></div>
    </div>
    <p class="subtitle">Archivo de Aventuras Eternas</p>
</header>

<main class="container">
    <section class="control-panel fade-in">
        <div class="filter-controls">
            <div class="filter-group">
                <label>üìÖ Por Fecha</label>
                <input type="date" id="filtroFecha" onchange="window.filtrar()">
            </div>
            <div class="filter-group">
                <label>‚≠ê Por Estrellas</label>
                <select id="filtroEstrellas" onchange="window.filtrar()">
                    <option value="todos">Todos</option>
                    <option value="10">10 Estrellas</option>
                    <option value="9">9 Estrellas</option>
                    <option value="8">8 Estrellas</option>
                    <option value="7">7 o menos</option>
                </select>
            </div>
            <button class="btn-reset" onclick="location.reload()">Limpiar Filtros</button>
        </div>
    </section>

    <section class="form-container fade-in">
        <h3>üìù Registrar Nueva Experiencia</h3>
        <select id="tipoEntrada" onchange="window.alternarCampos()">
            <option value="lugar">üìç Salida / Lugar</option>
            <option value="cine">üé¨ Pel√≠cula / Cine</option>
        </select>

        <div class="form-grid">
            <input type="text" id="nombre" placeholder="Nombre">
            <input type="text" id="foto" placeholder="URL de la imagen">
            <input type="date" id="fecha">
        </div>

        <div id="camposLugar">
            <input type="number" id="califLugar" placeholder="Puntuaci√≥n (1-10)" min="1" max="10">
            <textarea id="divertido" placeholder="Lo m√°s divertido..."></textarea>
            <textarea id="aburrido" placeholder="Lo m√°s aburrido..."></textarea>
            <input type="text" id="datoLugar" placeholder="Dato importante">
        </div>

        <div id="camposCine" style="display:none;">
            <input type="text" id="sensaciones" placeholder="Sensaciones">
            <input type="number" id="estrellas" placeholder="Estrellas (1-10)" min="1" max="10">
            <textarea id="gustoCine" placeholder="Lo que m√°s nos gust√≥..."></textarea>
            <textarea id="noGustoCine" placeholder="Lo que no nos gust√≥..."></textarea>
            <input type="text" id="datoCine" placeholder="Dato adicional">
        </div>

        <button class="btn-save" id="btnGuardar">Guardar en la Nube</button>
    </section>

    <div class="grid" id="contenedorPrincipal"></div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // DATOS EXTRA√çDOS DE SU CAPTURA
  const firebaseConfig = {
    apiKey: "AIzaSyDgc_fOFDZZTcBe2mtD0uGpgcFl4f34oPI",
    authDomain: "bitacora-ca.firebaseapp.com",
    projectId: "bitacora-ca",
    storageBucket: "bitacora-ca.firebasestorage.app",
    messagingSenderId: "707668977849",
    appId: "1:707668977849:web:5e72c6eb55fcdfb4dad368",
    measurementId: "G-BFZZW0151K",
    databaseURL: "https://bitacora-ca-default-rtdb.firebaseio.com/" 
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const aventurasRef = ref(db, 'aventuras');

  window.alternarCampos = function() {
    const tipo = document.getElementById('tipoEntrada').value;
    document.getElementById('camposLugar').style.display = tipo === 'lugar' ? 'block' : 'none';
    document.getElementById('camposCine').style.display = tipo === 'cine' ? 'block' : 'none';
  };

  document.getElementById('btnGuardar').onclick = function() {
    const tipo = document.getElementById('tipoEntrada').value;
    const nombre = document.getElementById('nombre').value;
    if(!nombre) return alert("Por favor, ingrese un nombre.");

    const nuevaEntrada = {
        tipo: tipo,
        nombre: nombre,
        foto: document.getElementById('foto').value || 'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=400',
        fecha: document.getElementById('fecha').value || new Date().toISOString().split('T')[0],
        rating: tipo === 'lugar' ? document.getElementById('califLugar').value : document.getElementById('estrellas').value
    };

    if (tipo === 'lugar') {
        nuevaEntrada.divertido = document.getElementById('divertido').value;
        nuevaEntrada.aburrido = document.getElementById('aburrido').value;
        nuevaEntrada.dato = document.getElementById('datoLugar').value;
    } else {
        nuevaEntrada.sensaciones = document.getElementById('sensaciones').value;
        nuevaEntrada.gusto = document.getElementById('gustoCine').value;
        nuevaEntrada.noGusto = document.getElementById('noGustoCine').value;
        nuevaEntrada.dato = document.getElementById('datoCine').value;
    }

    push(aventurasRef, nuevaEntrada).then(() => {
        alert("¬°Recuerdo guardado permanentemente!");
        location.reload();
    });
  };

  onValue(aventurasRef, (snapshot) => {
    const data = snapshot.val();
    window.datosRaw = data; // Para los filtros
    window.renderizar(data);
  });

  window.renderizar = function(data) {
    const contenedor = document.getElementById('contenedorPrincipal');
    contenedor.innerHTML = '';
    if (data) {
        Object.keys(data).reverse().forEach(key => {
            const e = data[key];
            contenedor.innerHTML += `
                <article class="card fade-in">
                    <img src="${e.foto}">
                    <div class="card-content">
                        <span class="badge ${e.tipo}">${e.tipo}</span>
                        <h3>${e.nombre}</h3>
                        <p class="card-date">üìÖ ${e.fecha}</p>
                        <p class="card-rating">‚≠ê ${e.rating}/10</p>
                        <button class="btn-delete" onclick="borrar('${key}')">Eliminar</button>
                    </div>
                </article>`;
        });
    }
  };

  window.filtrar = function() {
      const fFecha = document.getElementById('filtroFecha').value;
      const fEstrellas = document.getElementById('filtroEstrellas').value;
      let filtrados = {};
      
      Object.keys(window.datosRaw).forEach(key => {
          const e = window.datosRaw[key];
          let cumpleFecha = fFecha ? e.fecha === fFecha : true;
          let cumpleEstrellas = fEstrellas === "todos" ? true : (fEstrellas === "7" ? e.rating <= 7 : e.rating == fEstrellas);
          
          if(cumpleFecha && cumpleEstrellas) filtrados[key] = e;
      });
      window.renderizar(filtrados);
  };

  window.borrar = function(id) {
    if(confirm("¬øDesea borrar este recuerdo de la nube?")) {
        remove(ref(db, `aventuras/${id}`));
    }
  };
</script>
</body>
</html>
